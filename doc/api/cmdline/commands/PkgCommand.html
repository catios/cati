<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.9.1" />
<title>cmdline.commands.PkgCommand API documentation</title>
<meta name="description" content="Pkg command to work with .cati archives" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>cmdline.commands.PkgCommand</code></h1>
</header>
<section id="section-intro">
<p>Pkg command to work with .cati archives</p>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">#
# PkgCommand.py
#
# the cati project
# Copyright 2020 parsa mpsh &lt;parsampsh@gmail.com&gt;
#
# This file is part of cati.
#
# cati is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# cati is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with cati.  If not, see &lt;https://www.gnu.org/licenses/&gt;.
##################################################

&#39;&#39;&#39; Pkg command to work with .cati archives &#39;&#39;&#39;

from cmdline.BaseCommand import BaseCommand
from cmdline import pr, ansi
from dotcati.Builder import Builder
from dotcati.Installer import Installer
from dotcati.exceptions import InvalidPackageDirException, InvalidPackageFileException, DependencyError, ConflictError
from dotcati.ArchiveModel import ArchiveModel
from frontend.RootRequired import require_root_permission
from package.exceptions import CannotReadFileException
from cmdline.components import PackageShower

class PkgCommand(BaseCommand):
    def help(self):
        &#39;&#39;&#39;
        work with .cati packages
        Subcommands:
        - build:      build .cati package from directory(s)
        - show:       show content of .cati package(s). options: --files: show package files
        - install:    install a .cati package on system
        &#39;&#39;&#39;
        pass

    def config(self) -&gt; dict:
        &#39;&#39;&#39; Define and config this command &#39;&#39;&#39;
        return {
            &#39;name&#39;: &#39;pkg&#39;,
            &#39;options&#39;: {
                &#39;--output&#39;: [False, True],
                &#39;-o&#39;: [False, True],
                &#39;--files&#39;: [False, False],
                &#39;-f&#39;: [False, False],
                &#39;--auto&#39;: [False, False],
            },
            &#39;max_args_count&#39;: None,
            &#39;min_args_count&#39;: None,
        }

    def sub_build(self):
        if len(self.arguments) &lt;= 1:
            self.message(&#39;argument package directory(s) required&#39;)
            return 1

        i = 1
        while i &lt; len(self.arguments):
            try:
                output = self.option_value(&#39;--output&#39;)
                if output == None:
                    output = self.option_value(&#39;-o&#39;)
                builder = Builder()
                output_package = builder.build(self.arguments[i], output)

                pr.p(ansi.green + &#39;Package &#39; + self.arguments[i] + &#39; created successfuly in &#39; + output_package + ansi.reset)
            except FileNotFoundError as ex:
                self.message(&#39;directory &#34;&#39; + self.arguments[i] + &#39;&#34; not found&#39; + ansi.reset, before=ansi.red)
                return 1
            except InvalidPackageDirException as ex:
                self.message(&#39;cannot build &#34;&#39; + self.arguments[i] + &#39;&#34;: &#39; + str(ex) + ansi.reset, before=ansi.red)
                return 1

            i += 1

    def show_once(self, pkg: ArchiveModel):
        PackageShower.show(pkg.data)
        if self.has_option(&#39;--files&#39;) or self.has_option(&#39;-f&#39;):
            pr.p(&#39;Files:&#39;)
            pkg.tar.list()
        if len(self.arguments) &gt; 2:
            pr.p(&#39;=&#39;*50)

    def sub_show(self):
        if len(self.arguments) &lt;= 1:
            self.message(&#39;argument package file(s) required&#39;)
            return 1

        i = 1
        while i &lt; len(self.arguments):
            try:
                pkg = ArchiveModel(self.arguments[i], &#39;r&#39;)
                pkg.read()
                self.show_once(pkg)
                pkg.close()
            except FileNotFoundError as ex:
                self.message(&#39;file &#34;&#39; + self.arguments[i] + &#39;&#34; not found&#39; + ansi.reset, before=ansi.red)
            except:
                self.message(&#39;cannot open &#34;&#39; + self.arguments[i] + &#39;&#34;: file is corrupt&#39; + ansi.reset, before=ansi.red)

            i += 1

    def cannot_read_file_event(self, path):
        self.message(&#39;error while reading file &#34;&#39; + path + &#39;&#34;. ignored...&#39; + ansi.reset, before=ansi.red)

    def invalid_json_data_event(self, path):
        self.message(&#39;invalid json data in &#34;&#39; + path + &#39;&#34;. ignored...&#39; + ansi.reset, before=ansi.red)

    def package_currently_installed_event(self, package: ArchiveModel, current_version: str):
        pr.p(&#39;Installing &#39; + ansi.yellow + package.data[&#39;name&#39;] + &#39;:&#39; + package.data[&#39;version&#39;] + ansi.reset + &#39; (over &#39; + ansi.yellow + current_version + ansi.reset + &#39;)...&#39;, end=&#39; &#39;)

    def package_new_installs_event(self, package: ArchiveModel):
        pr.p(&#39;Installing &#39; + ansi.yellow + package.data[&#39;name&#39;] + &#39;:&#39; + package.data[&#39;version&#39;] + ansi.reset + &#39;...&#39;, end=&#39; &#39;)

    def package_installed_event(self, package: ArchiveModel):
        pr.p(ansi.green + &#39;OK&#39; + ansi.reset)

    def directory_not_empty_event(self, package: ArchiveModel, dirpath: str):
        pr.e(ansi.yellow + &#39;warning: directory &#34;&#39; + dirpath + &#39;&#34; is not empty and will not be deleted&#39; + ansi.reset)

    def dep_and_conflict_error_event(self, pkg: ArchiveModel, ex: Exception):
        pr.e(
            ansi.red +\
            &#39;Error while installing &#39; + pkg.data[&#39;name&#39;] + &#39; (&#39; + pkg.data[&#39;version&#39;] + &#39;):&#39;,
        )
        if isinstance(ex, DependencyError):
            pr.e(&#39;\tdependency error:&#39;)
        elif isinstance(ex, ConflictError):
            pr.e(&#39;\tconflict error:&#39;)
        pr.e(&#39;\t\t&#39; + str(ex))
        pr.e(ansi.reset)

        return 1

    def arch_error_event(self, pkg: ArchiveModel):
        pr.e(ansi.red + &#39;Architecture error while installing &#34;&#39; + pkg.data[&#39;name&#39;] + &#39;&#34;: your system does not support &#34;&#39; + pkg.data[&#39;arch&#39;] + &#39;&#34; packages.&#39; + ansi.reset)
        return 1

    def install_once(self, pkg: ArchiveModel):
        installer = Installer()

        try:
            out = installer.install(pkg,
                {
                    &#39;cannot_read_file&#39;: self.cannot_read_file_event,
                    &#39;invalid_json_data&#39;: self.invalid_json_data_event,
                },
                {
                    &#39;package_currently_installed&#39;: self.package_currently_installed_event,
                    &#39;package_new_installs&#39;: self.package_new_installs_event,
                    &#39;package_installed&#39;: self.package_installed_event,
                    &#39;directory_not_empty&#39;: self.directory_not_empty_event,
                    &#39;dep_and_conflict_error&#39;: self.dep_and_conflict_error_event,
                    &#39;arch_error&#39;: self.arch_error_event,
                },
                (not self.has_option(&#39;--auto&#39;))
            )

            if type(out) == int:
                return out
        except CannotReadFileException as ex:
            self.message(ansi.red + str(ex), True, before=ansi.reset)
        except:
            raise

    def sub_install(self):
        if len(self.arguments) &lt;= 1:
            self.message(&#39;argument package file(s) required&#39;)
            return 1

        require_root_permission()

        packages_to_install = []
        i = 1
        while i &lt; len(self.arguments):
            try:
                pkg = ArchiveModel(self.arguments[i], &#39;r&#39;)
                pkg.read()
                packages_to_install.append(pkg)
            except FileNotFoundError as ex:
                self.message(&#39;file &#34;&#39; + self.arguments[i] + &#39;&#34; not found&#39; + ansi.reset, before=ansi.red)
                return 1
            except:
                self.message(&#39;cannot open &#34;&#39; + self.arguments[i] + &#39;&#34;: file is corrupt&#39; + ansi.reset, before=ansi.red)
                return 1

            i += 1

        i = 0
        while i &lt; len(packages_to_install):
            try:
                pkg = packages_to_install[i]
                tmp = self.install_once(pkg)
                if type(tmp) == int and tmp != 0:
                    return tmp
                pkg.close()
            except:
                self.message(&#39;cannot install &#34;&#39; + packages_to_install[i].data[&#39;name&#39;] + ansi.reset, before=ansi.red)
                return 1
            i += 1

    def run(self):
        &#39;&#39;&#39; Run command &#39;&#39;&#39;

        if len(self.arguments) &lt;= 0:
            pr.p(self.help_full())
            return 0
        
        if self.arguments[0] == &#39;build&#39;:
            return self.sub_build()
        elif self.arguments[0] == &#39;show&#39;:
            return self.sub_show()
        elif self.arguments[0] == &#39;install&#39;:
            return self.sub_install()
        else:
            self.message(&#39;unknow subcommand &#34;&#39; + self.arguments[0] + &#39;&#34;&#39;, True)
            return 1</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="cmdline.commands.PkgCommand.PkgCommand"><code class="flex name class">
<span>class <span class="ident">PkgCommand</span></span>
</code></dt>
<dd>
<div class="desc"><p>Cmdline command model base</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class PkgCommand(BaseCommand):
    def help(self):
        &#39;&#39;&#39;
        work with .cati packages
        Subcommands:
        - build:      build .cati package from directory(s)
        - show:       show content of .cati package(s). options: --files: show package files
        - install:    install a .cati package on system
        &#39;&#39;&#39;
        pass

    def config(self) -&gt; dict:
        &#39;&#39;&#39; Define and config this command &#39;&#39;&#39;
        return {
            &#39;name&#39;: &#39;pkg&#39;,
            &#39;options&#39;: {
                &#39;--output&#39;: [False, True],
                &#39;-o&#39;: [False, True],
                &#39;--files&#39;: [False, False],
                &#39;-f&#39;: [False, False],
                &#39;--auto&#39;: [False, False],
            },
            &#39;max_args_count&#39;: None,
            &#39;min_args_count&#39;: None,
        }

    def sub_build(self):
        if len(self.arguments) &lt;= 1:
            self.message(&#39;argument package directory(s) required&#39;)
            return 1

        i = 1
        while i &lt; len(self.arguments):
            try:
                output = self.option_value(&#39;--output&#39;)
                if output == None:
                    output = self.option_value(&#39;-o&#39;)
                builder = Builder()
                output_package = builder.build(self.arguments[i], output)

                pr.p(ansi.green + &#39;Package &#39; + self.arguments[i] + &#39; created successfuly in &#39; + output_package + ansi.reset)
            except FileNotFoundError as ex:
                self.message(&#39;directory &#34;&#39; + self.arguments[i] + &#39;&#34; not found&#39; + ansi.reset, before=ansi.red)
                return 1
            except InvalidPackageDirException as ex:
                self.message(&#39;cannot build &#34;&#39; + self.arguments[i] + &#39;&#34;: &#39; + str(ex) + ansi.reset, before=ansi.red)
                return 1

            i += 1

    def show_once(self, pkg: ArchiveModel):
        PackageShower.show(pkg.data)
        if self.has_option(&#39;--files&#39;) or self.has_option(&#39;-f&#39;):
            pr.p(&#39;Files:&#39;)
            pkg.tar.list()
        if len(self.arguments) &gt; 2:
            pr.p(&#39;=&#39;*50)

    def sub_show(self):
        if len(self.arguments) &lt;= 1:
            self.message(&#39;argument package file(s) required&#39;)
            return 1

        i = 1
        while i &lt; len(self.arguments):
            try:
                pkg = ArchiveModel(self.arguments[i], &#39;r&#39;)
                pkg.read()
                self.show_once(pkg)
                pkg.close()
            except FileNotFoundError as ex:
                self.message(&#39;file &#34;&#39; + self.arguments[i] + &#39;&#34; not found&#39; + ansi.reset, before=ansi.red)
            except:
                self.message(&#39;cannot open &#34;&#39; + self.arguments[i] + &#39;&#34;: file is corrupt&#39; + ansi.reset, before=ansi.red)

            i += 1

    def cannot_read_file_event(self, path):
        self.message(&#39;error while reading file &#34;&#39; + path + &#39;&#34;. ignored...&#39; + ansi.reset, before=ansi.red)

    def invalid_json_data_event(self, path):
        self.message(&#39;invalid json data in &#34;&#39; + path + &#39;&#34;. ignored...&#39; + ansi.reset, before=ansi.red)

    def package_currently_installed_event(self, package: ArchiveModel, current_version: str):
        pr.p(&#39;Installing &#39; + ansi.yellow + package.data[&#39;name&#39;] + &#39;:&#39; + package.data[&#39;version&#39;] + ansi.reset + &#39; (over &#39; + ansi.yellow + current_version + ansi.reset + &#39;)...&#39;, end=&#39; &#39;)

    def package_new_installs_event(self, package: ArchiveModel):
        pr.p(&#39;Installing &#39; + ansi.yellow + package.data[&#39;name&#39;] + &#39;:&#39; + package.data[&#39;version&#39;] + ansi.reset + &#39;...&#39;, end=&#39; &#39;)

    def package_installed_event(self, package: ArchiveModel):
        pr.p(ansi.green + &#39;OK&#39; + ansi.reset)

    def directory_not_empty_event(self, package: ArchiveModel, dirpath: str):
        pr.e(ansi.yellow + &#39;warning: directory &#34;&#39; + dirpath + &#39;&#34; is not empty and will not be deleted&#39; + ansi.reset)

    def dep_and_conflict_error_event(self, pkg: ArchiveModel, ex: Exception):
        pr.e(
            ansi.red +\
            &#39;Error while installing &#39; + pkg.data[&#39;name&#39;] + &#39; (&#39; + pkg.data[&#39;version&#39;] + &#39;):&#39;,
        )
        if isinstance(ex, DependencyError):
            pr.e(&#39;\tdependency error:&#39;)
        elif isinstance(ex, ConflictError):
            pr.e(&#39;\tconflict error:&#39;)
        pr.e(&#39;\t\t&#39; + str(ex))
        pr.e(ansi.reset)

        return 1

    def arch_error_event(self, pkg: ArchiveModel):
        pr.e(ansi.red + &#39;Architecture error while installing &#34;&#39; + pkg.data[&#39;name&#39;] + &#39;&#34;: your system does not support &#34;&#39; + pkg.data[&#39;arch&#39;] + &#39;&#34; packages.&#39; + ansi.reset)
        return 1

    def install_once(self, pkg: ArchiveModel):
        installer = Installer()

        try:
            out = installer.install(pkg,
                {
                    &#39;cannot_read_file&#39;: self.cannot_read_file_event,
                    &#39;invalid_json_data&#39;: self.invalid_json_data_event,
                },
                {
                    &#39;package_currently_installed&#39;: self.package_currently_installed_event,
                    &#39;package_new_installs&#39;: self.package_new_installs_event,
                    &#39;package_installed&#39;: self.package_installed_event,
                    &#39;directory_not_empty&#39;: self.directory_not_empty_event,
                    &#39;dep_and_conflict_error&#39;: self.dep_and_conflict_error_event,
                    &#39;arch_error&#39;: self.arch_error_event,
                },
                (not self.has_option(&#39;--auto&#39;))
            )

            if type(out) == int:
                return out
        except CannotReadFileException as ex:
            self.message(ansi.red + str(ex), True, before=ansi.reset)
        except:
            raise

    def sub_install(self):
        if len(self.arguments) &lt;= 1:
            self.message(&#39;argument package file(s) required&#39;)
            return 1

        require_root_permission()

        packages_to_install = []
        i = 1
        while i &lt; len(self.arguments):
            try:
                pkg = ArchiveModel(self.arguments[i], &#39;r&#39;)
                pkg.read()
                packages_to_install.append(pkg)
            except FileNotFoundError as ex:
                self.message(&#39;file &#34;&#39; + self.arguments[i] + &#39;&#34; not found&#39; + ansi.reset, before=ansi.red)
                return 1
            except:
                self.message(&#39;cannot open &#34;&#39; + self.arguments[i] + &#39;&#34;: file is corrupt&#39; + ansi.reset, before=ansi.red)
                return 1

            i += 1

        i = 0
        while i &lt; len(packages_to_install):
            try:
                pkg = packages_to_install[i]
                tmp = self.install_once(pkg)
                if type(tmp) == int and tmp != 0:
                    return tmp
                pkg.close()
            except:
                self.message(&#39;cannot install &#34;&#39; + packages_to_install[i].data[&#39;name&#39;] + ansi.reset, before=ansi.red)
                return 1
            i += 1

    def run(self):
        &#39;&#39;&#39; Run command &#39;&#39;&#39;

        if len(self.arguments) &lt;= 0:
            pr.p(self.help_full())
            return 0
        
        if self.arguments[0] == &#39;build&#39;:
            return self.sub_build()
        elif self.arguments[0] == &#39;show&#39;:
            return self.sub_show()
        elif self.arguments[0] == &#39;install&#39;:
            return self.sub_install()
        else:
            self.message(&#39;unknow subcommand &#34;&#39; + self.arguments[0] + &#39;&#34;&#39;, True)
            return 1</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li><a title="cmdline.BaseCommand.BaseCommand" href="../BaseCommand.html#cmdline.BaseCommand.BaseCommand">BaseCommand</a></li>
</ul>
<h3>Methods</h3>
<dl>
<dt id="cmdline.commands.PkgCommand.PkgCommand.arch_error_event"><code class="name flex">
<span>def <span class="ident">arch_error_event</span></span>(<span>self, pkg: <a title="dotcati.ArchiveModel.ArchiveModel" href="../../dotcati/ArchiveModel.html#dotcati.ArchiveModel.ArchiveModel">ArchiveModel</a>)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def arch_error_event(self, pkg: ArchiveModel):
    pr.e(ansi.red + &#39;Architecture error while installing &#34;&#39; + pkg.data[&#39;name&#39;] + &#39;&#34;: your system does not support &#34;&#39; + pkg.data[&#39;arch&#39;] + &#39;&#34; packages.&#39; + ansi.reset)
    return 1</code></pre>
</details>
</dd>
<dt id="cmdline.commands.PkgCommand.PkgCommand.cannot_read_file_event"><code class="name flex">
<span>def <span class="ident">cannot_read_file_event</span></span>(<span>self, path)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def cannot_read_file_event(self, path):
    self.message(&#39;error while reading file &#34;&#39; + path + &#39;&#34;. ignored...&#39; + ansi.reset, before=ansi.red)</code></pre>
</details>
</dd>
<dt id="cmdline.commands.PkgCommand.PkgCommand.config"><code class="name flex">
<span>def <span class="ident">config</span></span>(<span>self) ‑> dict</span>
</code></dt>
<dd>
<div class="desc"><p>Define and config this command</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def config(self) -&gt; dict:
    &#39;&#39;&#39; Define and config this command &#39;&#39;&#39;
    return {
        &#39;name&#39;: &#39;pkg&#39;,
        &#39;options&#39;: {
            &#39;--output&#39;: [False, True],
            &#39;-o&#39;: [False, True],
            &#39;--files&#39;: [False, False],
            &#39;-f&#39;: [False, False],
            &#39;--auto&#39;: [False, False],
        },
        &#39;max_args_count&#39;: None,
        &#39;min_args_count&#39;: None,
    }</code></pre>
</details>
</dd>
<dt id="cmdline.commands.PkgCommand.PkgCommand.dep_and_conflict_error_event"><code class="name flex">
<span>def <span class="ident">dep_and_conflict_error_event</span></span>(<span>self, pkg: <a title="dotcati.ArchiveModel.ArchiveModel" href="../../dotcati/ArchiveModel.html#dotcati.ArchiveModel.ArchiveModel">ArchiveModel</a>, ex: Exception)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def dep_and_conflict_error_event(self, pkg: ArchiveModel, ex: Exception):
    pr.e(
        ansi.red +\
        &#39;Error while installing &#39; + pkg.data[&#39;name&#39;] + &#39; (&#39; + pkg.data[&#39;version&#39;] + &#39;):&#39;,
    )
    if isinstance(ex, DependencyError):
        pr.e(&#39;\tdependency error:&#39;)
    elif isinstance(ex, ConflictError):
        pr.e(&#39;\tconflict error:&#39;)
    pr.e(&#39;\t\t&#39; + str(ex))
    pr.e(ansi.reset)

    return 1</code></pre>
</details>
</dd>
<dt id="cmdline.commands.PkgCommand.PkgCommand.directory_not_empty_event"><code class="name flex">
<span>def <span class="ident">directory_not_empty_event</span></span>(<span>self, package: <a title="dotcati.ArchiveModel.ArchiveModel" href="../../dotcati/ArchiveModel.html#dotcati.ArchiveModel.ArchiveModel">ArchiveModel</a>, dirpath: str)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def directory_not_empty_event(self, package: ArchiveModel, dirpath: str):
    pr.e(ansi.yellow + &#39;warning: directory &#34;&#39; + dirpath + &#39;&#34; is not empty and will not be deleted&#39; + ansi.reset)</code></pre>
</details>
</dd>
<dt id="cmdline.commands.PkgCommand.PkgCommand.help"><code class="name flex">
<span>def <span class="ident">help</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>work with .cati packages
Subcommands:
- build:
build .cati package from directory(s)
- show:
show content of .cati package(s). options: &ndash;files: show package files
- install:
install a .cati package on system</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def help(self):
    &#39;&#39;&#39;
    work with .cati packages
    Subcommands:
    - build:      build .cati package from directory(s)
    - show:       show content of .cati package(s). options: --files: show package files
    - install:    install a .cati package on system
    &#39;&#39;&#39;
    pass</code></pre>
</details>
</dd>
<dt id="cmdline.commands.PkgCommand.PkgCommand.install_once"><code class="name flex">
<span>def <span class="ident">install_once</span></span>(<span>self, pkg: <a title="dotcati.ArchiveModel.ArchiveModel" href="../../dotcati/ArchiveModel.html#dotcati.ArchiveModel.ArchiveModel">ArchiveModel</a>)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def install_once(self, pkg: ArchiveModel):
    installer = Installer()

    try:
        out = installer.install(pkg,
            {
                &#39;cannot_read_file&#39;: self.cannot_read_file_event,
                &#39;invalid_json_data&#39;: self.invalid_json_data_event,
            },
            {
                &#39;package_currently_installed&#39;: self.package_currently_installed_event,
                &#39;package_new_installs&#39;: self.package_new_installs_event,
                &#39;package_installed&#39;: self.package_installed_event,
                &#39;directory_not_empty&#39;: self.directory_not_empty_event,
                &#39;dep_and_conflict_error&#39;: self.dep_and_conflict_error_event,
                &#39;arch_error&#39;: self.arch_error_event,
            },
            (not self.has_option(&#39;--auto&#39;))
        )

        if type(out) == int:
            return out
    except CannotReadFileException as ex:
        self.message(ansi.red + str(ex), True, before=ansi.reset)
    except:
        raise</code></pre>
</details>
</dd>
<dt id="cmdline.commands.PkgCommand.PkgCommand.invalid_json_data_event"><code class="name flex">
<span>def <span class="ident">invalid_json_data_event</span></span>(<span>self, path)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def invalid_json_data_event(self, path):
    self.message(&#39;invalid json data in &#34;&#39; + path + &#39;&#34;. ignored...&#39; + ansi.reset, before=ansi.red)</code></pre>
</details>
</dd>
<dt id="cmdline.commands.PkgCommand.PkgCommand.package_currently_installed_event"><code class="name flex">
<span>def <span class="ident">package_currently_installed_event</span></span>(<span>self, package: <a title="dotcati.ArchiveModel.ArchiveModel" href="../../dotcati/ArchiveModel.html#dotcati.ArchiveModel.ArchiveModel">ArchiveModel</a>, current_version: str)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def package_currently_installed_event(self, package: ArchiveModel, current_version: str):
    pr.p(&#39;Installing &#39; + ansi.yellow + package.data[&#39;name&#39;] + &#39;:&#39; + package.data[&#39;version&#39;] + ansi.reset + &#39; (over &#39; + ansi.yellow + current_version + ansi.reset + &#39;)...&#39;, end=&#39; &#39;)</code></pre>
</details>
</dd>
<dt id="cmdline.commands.PkgCommand.PkgCommand.package_installed_event"><code class="name flex">
<span>def <span class="ident">package_installed_event</span></span>(<span>self, package: <a title="dotcati.ArchiveModel.ArchiveModel" href="../../dotcati/ArchiveModel.html#dotcati.ArchiveModel.ArchiveModel">ArchiveModel</a>)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def package_installed_event(self, package: ArchiveModel):
    pr.p(ansi.green + &#39;OK&#39; + ansi.reset)</code></pre>
</details>
</dd>
<dt id="cmdline.commands.PkgCommand.PkgCommand.package_new_installs_event"><code class="name flex">
<span>def <span class="ident">package_new_installs_event</span></span>(<span>self, package: <a title="dotcati.ArchiveModel.ArchiveModel" href="../../dotcati/ArchiveModel.html#dotcati.ArchiveModel.ArchiveModel">ArchiveModel</a>)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def package_new_installs_event(self, package: ArchiveModel):
    pr.p(&#39;Installing &#39; + ansi.yellow + package.data[&#39;name&#39;] + &#39;:&#39; + package.data[&#39;version&#39;] + ansi.reset + &#39;...&#39;, end=&#39; &#39;)</code></pre>
</details>
</dd>
<dt id="cmdline.commands.PkgCommand.PkgCommand.run"><code class="name flex">
<span>def <span class="ident">run</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Run command</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def run(self):
    &#39;&#39;&#39; Run command &#39;&#39;&#39;

    if len(self.arguments) &lt;= 0:
        pr.p(self.help_full())
        return 0
    
    if self.arguments[0] == &#39;build&#39;:
        return self.sub_build()
    elif self.arguments[0] == &#39;show&#39;:
        return self.sub_show()
    elif self.arguments[0] == &#39;install&#39;:
        return self.sub_install()
    else:
        self.message(&#39;unknow subcommand &#34;&#39; + self.arguments[0] + &#39;&#34;&#39;, True)
        return 1</code></pre>
</details>
</dd>
<dt id="cmdline.commands.PkgCommand.PkgCommand.show_once"><code class="name flex">
<span>def <span class="ident">show_once</span></span>(<span>self, pkg: <a title="dotcati.ArchiveModel.ArchiveModel" href="../../dotcati/ArchiveModel.html#dotcati.ArchiveModel.ArchiveModel">ArchiveModel</a>)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def show_once(self, pkg: ArchiveModel):
    PackageShower.show(pkg.data)
    if self.has_option(&#39;--files&#39;) or self.has_option(&#39;-f&#39;):
        pr.p(&#39;Files:&#39;)
        pkg.tar.list()
    if len(self.arguments) &gt; 2:
        pr.p(&#39;=&#39;*50)</code></pre>
</details>
</dd>
<dt id="cmdline.commands.PkgCommand.PkgCommand.sub_build"><code class="name flex">
<span>def <span class="ident">sub_build</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def sub_build(self):
    if len(self.arguments) &lt;= 1:
        self.message(&#39;argument package directory(s) required&#39;)
        return 1

    i = 1
    while i &lt; len(self.arguments):
        try:
            output = self.option_value(&#39;--output&#39;)
            if output == None:
                output = self.option_value(&#39;-o&#39;)
            builder = Builder()
            output_package = builder.build(self.arguments[i], output)

            pr.p(ansi.green + &#39;Package &#39; + self.arguments[i] + &#39; created successfuly in &#39; + output_package + ansi.reset)
        except FileNotFoundError as ex:
            self.message(&#39;directory &#34;&#39; + self.arguments[i] + &#39;&#34; not found&#39; + ansi.reset, before=ansi.red)
            return 1
        except InvalidPackageDirException as ex:
            self.message(&#39;cannot build &#34;&#39; + self.arguments[i] + &#39;&#34;: &#39; + str(ex) + ansi.reset, before=ansi.red)
            return 1

        i += 1</code></pre>
</details>
</dd>
<dt id="cmdline.commands.PkgCommand.PkgCommand.sub_install"><code class="name flex">
<span>def <span class="ident">sub_install</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def sub_install(self):
    if len(self.arguments) &lt;= 1:
        self.message(&#39;argument package file(s) required&#39;)
        return 1

    require_root_permission()

    packages_to_install = []
    i = 1
    while i &lt; len(self.arguments):
        try:
            pkg = ArchiveModel(self.arguments[i], &#39;r&#39;)
            pkg.read()
            packages_to_install.append(pkg)
        except FileNotFoundError as ex:
            self.message(&#39;file &#34;&#39; + self.arguments[i] + &#39;&#34; not found&#39; + ansi.reset, before=ansi.red)
            return 1
        except:
            self.message(&#39;cannot open &#34;&#39; + self.arguments[i] + &#39;&#34;: file is corrupt&#39; + ansi.reset, before=ansi.red)
            return 1

        i += 1

    i = 0
    while i &lt; len(packages_to_install):
        try:
            pkg = packages_to_install[i]
            tmp = self.install_once(pkg)
            if type(tmp) == int and tmp != 0:
                return tmp
            pkg.close()
        except:
            self.message(&#39;cannot install &#34;&#39; + packages_to_install[i].data[&#39;name&#39;] + ansi.reset, before=ansi.red)
            return 1
        i += 1</code></pre>
</details>
</dd>
<dt id="cmdline.commands.PkgCommand.PkgCommand.sub_show"><code class="name flex">
<span>def <span class="ident">sub_show</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def sub_show(self):
    if len(self.arguments) &lt;= 1:
        self.message(&#39;argument package file(s) required&#39;)
        return 1

    i = 1
    while i &lt; len(self.arguments):
        try:
            pkg = ArchiveModel(self.arguments[i], &#39;r&#39;)
            pkg.read()
            self.show_once(pkg)
            pkg.close()
        except FileNotFoundError as ex:
            self.message(&#39;file &#34;&#39; + self.arguments[i] + &#39;&#34; not found&#39; + ansi.reset, before=ansi.red)
        except:
            self.message(&#39;cannot open &#34;&#39; + self.arguments[i] + &#39;&#34;: file is corrupt&#39; + ansi.reset, before=ansi.red)

        i += 1</code></pre>
</details>
</dd>
</dl>
<h3>Inherited members</h3>
<ul class="hlist">
<li><code><b><a title="cmdline.BaseCommand.BaseCommand" href="../BaseCommand.html#cmdline.BaseCommand.BaseCommand">BaseCommand</a></b></code>:
<ul class="hlist">
<li><code><a title="cmdline.BaseCommand.BaseCommand.handle" href="../BaseCommand.html#cmdline.BaseCommand.BaseCommand.handle">handle</a></code></li>
<li><code><a title="cmdline.BaseCommand.BaseCommand.has_option" href="../BaseCommand.html#cmdline.BaseCommand.BaseCommand.has_option">has_option</a></code></li>
<li><code><a title="cmdline.BaseCommand.BaseCommand.help_full" href="../BaseCommand.html#cmdline.BaseCommand.BaseCommand.help_full">help_full</a></code></li>
<li><code><a title="cmdline.BaseCommand.BaseCommand.help_summary" href="../BaseCommand.html#cmdline.BaseCommand.BaseCommand.help_summary">help_summary</a></code></li>
<li><code><a title="cmdline.BaseCommand.BaseCommand.message" href="../BaseCommand.html#cmdline.BaseCommand.BaseCommand.message">message</a></code></li>
<li><code><a title="cmdline.BaseCommand.BaseCommand.option_value" href="../BaseCommand.html#cmdline.BaseCommand.BaseCommand.option_value">option_value</a></code></li>
<li><code><a title="cmdline.BaseCommand.BaseCommand.validate" href="../BaseCommand.html#cmdline.BaseCommand.BaseCommand.validate">validate</a></code></li>
</ul>
</li>
</ul>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="cmdline.commands" href="index.html">cmdline.commands</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="cmdline.commands.PkgCommand.PkgCommand" href="#cmdline.commands.PkgCommand.PkgCommand">PkgCommand</a></code></h4>
<ul class="">
<li><code><a title="cmdline.commands.PkgCommand.PkgCommand.arch_error_event" href="#cmdline.commands.PkgCommand.PkgCommand.arch_error_event">arch_error_event</a></code></li>
<li><code><a title="cmdline.commands.PkgCommand.PkgCommand.cannot_read_file_event" href="#cmdline.commands.PkgCommand.PkgCommand.cannot_read_file_event">cannot_read_file_event</a></code></li>
<li><code><a title="cmdline.commands.PkgCommand.PkgCommand.config" href="#cmdline.commands.PkgCommand.PkgCommand.config">config</a></code></li>
<li><code><a title="cmdline.commands.PkgCommand.PkgCommand.dep_and_conflict_error_event" href="#cmdline.commands.PkgCommand.PkgCommand.dep_and_conflict_error_event">dep_and_conflict_error_event</a></code></li>
<li><code><a title="cmdline.commands.PkgCommand.PkgCommand.directory_not_empty_event" href="#cmdline.commands.PkgCommand.PkgCommand.directory_not_empty_event">directory_not_empty_event</a></code></li>
<li><code><a title="cmdline.commands.PkgCommand.PkgCommand.help" href="#cmdline.commands.PkgCommand.PkgCommand.help">help</a></code></li>
<li><code><a title="cmdline.commands.PkgCommand.PkgCommand.install_once" href="#cmdline.commands.PkgCommand.PkgCommand.install_once">install_once</a></code></li>
<li><code><a title="cmdline.commands.PkgCommand.PkgCommand.invalid_json_data_event" href="#cmdline.commands.PkgCommand.PkgCommand.invalid_json_data_event">invalid_json_data_event</a></code></li>
<li><code><a title="cmdline.commands.PkgCommand.PkgCommand.package_currently_installed_event" href="#cmdline.commands.PkgCommand.PkgCommand.package_currently_installed_event">package_currently_installed_event</a></code></li>
<li><code><a title="cmdline.commands.PkgCommand.PkgCommand.package_installed_event" href="#cmdline.commands.PkgCommand.PkgCommand.package_installed_event">package_installed_event</a></code></li>
<li><code><a title="cmdline.commands.PkgCommand.PkgCommand.package_new_installs_event" href="#cmdline.commands.PkgCommand.PkgCommand.package_new_installs_event">package_new_installs_event</a></code></li>
<li><code><a title="cmdline.commands.PkgCommand.PkgCommand.run" href="#cmdline.commands.PkgCommand.PkgCommand.run">run</a></code></li>
<li><code><a title="cmdline.commands.PkgCommand.PkgCommand.show_once" href="#cmdline.commands.PkgCommand.PkgCommand.show_once">show_once</a></code></li>
<li><code><a title="cmdline.commands.PkgCommand.PkgCommand.sub_build" href="#cmdline.commands.PkgCommand.PkgCommand.sub_build">sub_build</a></code></li>
<li><code><a title="cmdline.commands.PkgCommand.PkgCommand.sub_install" href="#cmdline.commands.PkgCommand.PkgCommand.sub_install">sub_install</a></code></li>
<li><code><a title="cmdline.commands.PkgCommand.PkgCommand.sub_show" href="#cmdline.commands.PkgCommand.PkgCommand.sub_show">sub_show</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc"><cite>pdoc</cite> 0.9.1</a>.</p>
</footer>
</body>
</html>